<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Progresso de Protocolos</title>
<style>
  :root { --green:#4caf50; --gray:#e0e0e0; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: Arial, Helvetica, sans-serif; background:#f5f5f5; color:#333;
         min-height:100vh; display:flex; align-items:center; justify-content:center; }
  .wrap { text-align:center; padding:24px; }
  .ring { position:relative; width:240px; height:240px; margin:0 auto 16px;
          border-radius:50%; background:conic-gradient(var(--green) var(--angle,0deg), var(--gray) var(--angle,0deg));
          display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,.08); }
  .ring::before { content:""; position:absolute; width:180px; height:180px; border-radius:50%; background:#fff; }
  .center { position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; }
  .pct { font-size:2rem; font-weight:700; }
  .cnt { margin-top:.25rem; font-size:1rem; color:#444; }
  .note { margin-top:.75rem; font-size:.95rem; color:#666; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="ring" id="ring" style="--angle:0deg">
      <div class="center">
        <div class="pct" id="pct">0,0%</div>
        <div class="cnt" id="cnt">0 de 0</div>
      </div>
    </div>
    <div class="note" id="meta">Progresso de protocolos concluídos</div>
    <div class="note" id="upd"></div>
  </div>

<script>      
const FALLBACK_TOTAL = 2589; // total padrão se o JSON não trouxer
const DATA_URL = "status.json"; // mesmo repositório (raiz)

function formatPct(p){ return (p*100).toFixed(1).replace('.',',') + "%"; }

function render(done, total, updatedAt){
  total = Number.isFinite(total) && total > 0 ? total : FALLBACK_TOTAL;
  done  = Math.max(0, Number(done) || 0);
  const pct = Math.min(1, done/total);
  document.getElementById("ring").style.setProperty("--angle", (pct*360) + "deg");
  document.getElementById("pct").textContent = formatPct(pct);
  document.getElementById("cnt").textContent = `${done.toLocaleString('pt-BR')} de ${total.toLocaleString('pt-BR')}`;
  document.getElementById("upd").textContent = updatedAt
    ? `Atualizado: ${new Date(updatedAt).toLocaleString('pt-BR')}`
    : "";
}

async function fetchData(){
  try{
    const res  = await fetch(`${DATA_URL}?ts=${Date.now()}`, { cache: "no-store" });
    const json = await res.json();
    render(json.done, json.total, json.updated_at);
  }catch(e){
    console.error(e);
    render(0, FALLBACK_TOTAL, null);
  }
}

fetchData();
setInterval(fetchData, 60000); // atualiza a cada 60s
</script>
</body>
</html>
